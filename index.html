<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Caveau Digitale</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
  <style>
    *{-webkit-tap-highlight-color:transparent}
    body{-webkit-font-smoothing:antialiased}
    .screen{display:none}.screen.active{display:flex;flex-direction:column}
    .modal-overlay{display:none}.modal-overlay.active{display:flex}
    .pin-dot{width:14px;height:14px;border-radius:50%;border:2px solid #475569;transition:all .15s}
    .pin-dot.filled{background:#3b82f6;border-color:#3b82f6}
    .pin-key:active{transform:scale(.92);background:#334155}
    input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(1)}
    ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#334155;border-radius:2px}
    .vault-card{transition:all .2s ease}
    .vault-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.3)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn .3s ease forwards}
  </style>
</head>
<body class="bg-slate-900 text-white min-h-screen overflow-x-hidden">

<!-- WELCOME -->
<div id="screen-welcome" class="screen min-h-screen items-center justify-center p-6">
  <div class="w-full max-w-sm mx-auto text-center">
    <div class="fade-in mb-12">
      <div class="text-8xl mb-5">ğŸ”</div>
      <h1 class="text-4xl font-bold mb-2">Caveau Digitale</h1>
      <p class="text-slate-400 mb-3">Protocollo di Risparmio Inviolabile</p>
      <div class="flex justify-center gap-4 text-xs text-slate-500">
        <span>â›“ Non-Custodial</span><span class="text-slate-700">â€¢</span>
        <span>ğŸ“‚ Open Source</span><span class="text-slate-700">â€¢</span>
        <span>ğŸŒ Web3</span>
      </div>
    </div>
    <div class="space-y-3">
      <button onclick="App.startCreateWallet()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl text-base font-semibold shadow-lg shadow-blue-900/30 transition-colors">ğŸ†• Crea Nuovo Portafoglio</button>
      <button onclick="App.showRestoreWallet()" class="w-full bg-slate-800 hover:bg-slate-700 border border-slate-700 py-4 rounded-2xl text-base font-semibold transition-colors">ğŸ”‘ Ripristina con Seed Phrase</button>
    </div>
    <p class="text-slate-600 text-xs mt-8 leading-relaxed">Le tue chiavi non lasciano mai questo dispositivo.<br>Nessun server. Nessun intermediario.</p>
  </div>
</div>

<!-- SHOW SEED -->
<div id="screen-seed-create" class="screen min-h-screen p-6">
  <div class="w-full max-w-md mx-auto">
    <button onclick="App.goBack()" class="text-slate-400 hover:text-white mb-6 flex items-center gap-1 text-sm">â† Indietro</button>
    <h2 class="text-2xl font-bold mb-1">La tua Seed Phrase</h2>
    <p class="text-slate-400 text-sm mb-4">Queste 12 parole sono l'unica chiave del tuo Caveau. Scrivile su carta adesso.</p>
    <div class="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 mb-6">
      <p class="text-amber-400 text-sm font-semibold">âš ï¸ Attenzione Critica</p>
      <p class="text-amber-300/80 text-xs mt-1 leading-relaxed">Se perdi queste parole, perdi accesso ai risparmi <strong>per sempre</strong>. Nessuno puÃ² recuperarle.</p>
    </div>
    <div id="seed-words-grid" class="grid grid-cols-3 gap-2.5 mb-8"></div>
    <div class="flex gap-3">
      <button onclick="App.goBack()" class="flex-1 bg-slate-800 border border-slate-700 py-4 rounded-xl font-medium text-sm transition-colors">Annulla</button>
      <button onclick="App.confirmSeedWritten()" class="flex-[2] bg-blue-600 hover:bg-blue-500 py-4 px-4 rounded-xl font-semibold text-sm transition-colors">âœ… L'ho scritta â†’ Continua</button>
    </div>
  </div>
</div>

<!-- SET PIN -->
<div id="screen-set-pin" class="screen min-h-screen items-center justify-center p-6">
  <div class="w-full max-w-xs mx-auto text-center">
    <div class="text-5xl mb-4">ğŸ”‘</div>
    <h2 class="text-2xl font-bold mb-1" id="set-pin-title">Crea il tuo PIN</h2>
    <p class="text-slate-400 text-sm mb-8" id="set-pin-desc">Scegli un PIN di 6 cifre per sbloccare il Caveau rapidamente.</p>
    <div class="flex justify-center gap-3 mb-8" id="pin-dots-set">
      <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
      <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
    </div>
    <div id="pin-error-set" class="hidden text-red-400 text-sm mb-4 bg-red-500/10 py-2 px-4 rounded-xl"></div>
    <div class="grid grid-cols-3 gap-3 max-w-[220px] mx-auto">
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('1','set')">1</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('2','set')">2</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('3','set')">3</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('4','set')">4</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('5','set')">5</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('6','set')">6</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('7','set')">7</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('8','set')">8</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('9','set')">9</button>
      <div></div>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('0','set')">0</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinBackspace('set')">âŒ«</button>
    </div>
  </div>
</div>

<!-- UNLOCK -->
<div id="screen-unlock" class="screen min-h-screen items-center justify-center p-6">
  <div class="w-full max-w-xs mx-auto text-center">
    <div class="text-5xl mb-3">ğŸ”</div>
    <h2 class="text-2xl font-bold mb-1">Bentornato</h2>
    <p class="text-slate-500 text-xs mb-1" id="unlock-address-short"></p>
    <p class="text-slate-400 text-sm mb-8">Inserisci il PIN per sbloccare il Caveau</p>
    <div class="flex justify-center gap-3 mb-8" id="pin-dots-unlock">
      <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
      <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
    </div>
    <div id="pin-error-unlock" class="hidden text-red-400 text-sm mb-4 bg-red-500/10 py-2 px-4 rounded-xl"></div>
    <div class="grid grid-cols-3 gap-3 max-w-[220px] mx-auto">
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('1','unlock')">1</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('2','unlock')">2</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('3','unlock')">3</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('4','unlock')">4</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('5','unlock')">5</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('6','unlock')">6</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('7','unlock')">7</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('8','unlock')">8</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('9','unlock')">9</button>
      <div></div>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinKeyPress('0','unlock')">0</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-14 text-xl font-semibold" onclick="App.pinBackspace('unlock')">âŒ«</button>
    </div>
    <button onclick="App.forgotPin()" class="text-slate-500 hover:text-slate-300 text-sm mt-6 block mx-auto transition-colors">PIN dimenticato? Usa la Seed Phrase â†’</button>
  </div>
</div>

<!-- RESTORE -->
<div id="screen-seed-restore" class="screen min-h-screen p-6">
  <div class="w-full max-w-md mx-auto">
    <button onclick="App.goBack()" class="text-slate-400 hover:text-white mb-6 flex items-center gap-1 text-sm">â† Indietro</button>
    <h2 class="text-2xl font-bold mb-1" id="restore-title">Ripristina Portafoglio</h2>
    <p class="text-slate-400 text-sm mb-6" id="restore-desc">Inserisci le tue 12 parole nell'ordine corretto.</p>
    <div id="restore-words-grid" class="grid grid-cols-3 gap-2 mb-5"></div>
    <div id="restore-error" class="hidden bg-red-500/10 border border-red-500/30 text-red-400 text-sm p-3 rounded-xl mb-4"></div>
    <button onclick="App.restoreWallet()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-semibold transition-colors">ğŸ”“ Ripristina e Continua</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="screen-dashboard" class="screen min-h-screen flex-col">
  <header class="bg-slate-800/80 backdrop-blur-md sticky top-0 z-10 px-4 py-3 border-b border-slate-700/50">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-2.5">
        <span class="text-2xl">ğŸ”</span>
        <div><span class="font-bold text-base block leading-tight">Caveau Digitale</span><span class="text-xs text-slate-500">Protocollo Inviolabile</span></div>
      </div>
      <div class="flex items-center gap-3">
        <span class="bg-green-500/15 text-green-400 text-xs px-2.5 py-1 rounded-full border border-green-500/25 font-medium">ğŸŸ¢ Polygon</span>
        <button onclick="App.openTransak()" class="bg-blue-600/20 hover:bg-blue-600/40 border border-blue-500/30 text-blue-400 text-xs px-3 py-1.5 rounded-full font-medium transition-colors">ğŸ’³ Compra</button>
        <button onclick="App.showSettings()" class="text-slate-400 hover:text-white text-xl">âš™ï¸</button>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-6 w-full flex-1">
    <!-- Stats -->
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-8">
      <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700 col-span-2 md:col-span-1">
        <p class="text-slate-400 text-xs font-medium uppercase tracking-wider mb-2">Capitale Congelato</p>
        <div class="flex items-baseline gap-2">
          <p class="text-3xl font-bold" id="stat-total">0.00</p>
          <span class="text-slate-400 text-sm" id="stat-currency">USDC</span>
        </div>
      </div>
      <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700">
        <p class="text-slate-400 text-xs font-medium uppercase tracking-wider mb-2">Salvadanai</p>
        <p class="text-3xl font-bold" id="stat-vaults">0</p>
        <p class="text-slate-400 text-xs mt-1">obiettivi attivi</p>
      </div>
      <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700">
        <p class="text-slate-400 text-xs font-medium uppercase tracking-wider mb-2">Prossimo Sblocco</p>
        <p class="text-base font-bold leading-tight" id="stat-next-unlock">â€”</p>
        <p class="text-slate-400 text-xs mt-1" id="stat-days-left">nessun vincolo</p>
      </div>
    </div>

    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold">I Tuoi Salvadanai</h2>
      <button onclick="App.showNewVaultModal()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-semibold transition-colors">+ Nuovo</button>
    </div>

    <div id="vaults-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
      <div id="empty-vaults" class="col-span-full border-2 border-dashed border-slate-700/60 rounded-2xl p-12 text-center text-slate-500">
        <div class="text-5xl mb-3">ğŸ¯</div>
        <p class="font-medium">Nessun salvadanaio ancora</p>
        <p class="text-sm mt-1">Crea il tuo primo vincolo per iniziare</p>
      </div>
    </div>

    <div id="chart-section" class="hidden bg-slate-800 rounded-2xl p-6 border border-slate-700 mb-8">
      <h3 class="font-semibold mb-1">Andamento Complessivo</h3>
      <p class="text-slate-400 text-xs mb-4">Progressione totale dei fondi congelati</p>
      <canvas id="main-chart" height="100"></canvas>
    </div>

    <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700/50 text-center">
      <p class="text-slate-400 text-sm mb-3">Questo protocollo Ã¨ gratuito e open source.<br>Se ti Ã¨ utile, considera una piccola mancia.</p>
      <button onclick="App.copyDonationAddress()" class="inline-flex items-center gap-2 bg-slate-700 hover:bg-slate-600 border border-slate-600 px-5 py-2.5 rounded-full text-sm font-medium transition-colors">â˜• Dona 1 USDC</button>
      <p id="donation-copied" class="hidden text-green-400 text-xs mt-2">âœ… Indirizzo copiato!</p>
    </div>
  </main>
</div>

<!-- MODAL: NEW VAULT -->
<div id="modal-new-vault" class="modal-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-end md:items-center justify-center p-4" onclick="App.closeModal('modal-new-vault')">
  <div class="bg-slate-800 rounded-3xl w-full max-w-md border border-slate-600 overflow-hidden" onclick="event.stopPropagation()">
    <div class="p-6">
      <div class="flex justify-between items-center mb-5">
        <h3 class="text-xl font-bold">Nuovo Salvadanaio</h3>
        <button onclick="App.closeModal('modal-new-vault')" class="text-slate-400 hover:text-white text-2xl leading-none">Ã—</button>
      </div>
      <p class="text-slate-400 text-xs uppercase tracking-wider mb-3">Scegli l'Obiettivo</p>
      <div id="icon-picker" class="grid grid-cols-5 gap-2 mb-5"></div>
      <div class="mb-4">
        <label class="text-slate-400 text-xs uppercase tracking-wider mb-2 block">Nome</label>
        <input id="vault-name" type="text" maxlength="30" class="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="es. Vacanze a Ibiza">
      </div>
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div>
          <label class="text-slate-400 text-xs uppercase tracking-wider mb-2 block">Obiettivo</label>
          <input id="vault-target" type="number" min="1" class="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" placeholder="11000">
        </div>
        <div>
          <label class="text-slate-400 text-xs uppercase tracking-wider mb-2 block">Valuta</label>
          <select id="vault-currency" class="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500">
            <option value="USDC">USDC</option>
            <option value="EURC">EURC</option>
            <option value="DAI">DAI</option>
            <option value="USDT">USDT</option>
          </select>
        </div>
      </div>
      <div class="mb-5">
        <label class="text-slate-400 text-xs uppercase tracking-wider mb-2 block">Data di Sblocco</label>
        <input id="vault-date" type="date" class="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500">
      </div>
      <div id="vault-error" class="hidden bg-red-500/10 border border-red-500/30 text-red-400 text-sm p-3 rounded-xl mb-4"></div>
      <button onclick="App.createVault()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-semibold transition-colors">ğŸ”’ Crea e Congela</button>
    </div>
  </div>
</div>

<!-- MODAL: VAULT DETAIL -->
<div id="modal-vault-detail" class="modal-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-end md:items-center justify-center p-4" onclick="App.closeModal('modal-vault-detail')">
  <div class="bg-slate-800 rounded-3xl w-full max-w-md border border-slate-600 max-h-[92vh] overflow-y-auto" onclick="event.stopPropagation()">
    <div class="p-6">
      <div class="flex justify-between items-center mb-5">
        <h3 class="text-xl font-bold" id="detail-title"></h3>
        <button onclick="App.closeModal('modal-vault-detail')" class="text-slate-400 hover:text-white text-2xl leading-none">Ã—</button>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 mb-4">
        <div class="flex justify-between text-sm mb-2">
          <span class="text-slate-400">Congelato</span>
          <span class="font-semibold" id="detail-amount">0</span>
        </div>
        <div class="w-full bg-slate-700 rounded-full h-3 mb-2">
          <div id="detail-progress-bar" class="h-3 rounded-full transition-all duration-500" style="width:0%"></div>
        </div>
        <div class="flex justify-between text-xs text-slate-400">
          <span id="detail-pct">0%</span>
          <span>Obiettivo: <span id="detail-target">0</span></span>
        </div>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 mb-4 text-center">
        <p class="text-slate-400 text-xs mb-1">SBLOCCO TRA</p>
        <p class="text-3xl font-bold" id="detail-countdown">â€”</p>
        <p class="text-slate-400 text-sm mt-1" id="detail-unlock-date"></p>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 mb-4">
        <canvas id="vault-chart" height="90"></canvas>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 mb-4">
        <p class="text-slate-400 text-xs uppercase tracking-wider mb-3">Blocca Fondi su Polygon</p>
        <div id="deposit-error" class="hidden bg-red-500/10 border border-red-500/30 text-red-400 text-xs p-2 rounded-xl mb-2"></div>
        <div class="flex gap-2 mb-2">
          <input id="deposit-amount" type="number" min="0.01" step="0.01" placeholder="500" class="flex-1 bg-slate-800 border border-slate-600 rounded-xl px-3 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 text-sm">
          <button onclick="App.showSablierLock()" class="bg-blue-600 hover:bg-blue-500 px-4 py-2.5 rounded-xl text-sm font-semibold transition-colors">ğŸ”’ Blocca</button>
        </div>
        <button onclick="App.addDeposit()" class="text-slate-500 hover:text-slate-400 text-xs transition-colors">ğŸ“ Registra manualmente (senza blockchain)</button>
      </div>
      <div class="mb-4">
        <p class="text-slate-400 text-xs uppercase tracking-wider mb-3">Registro Transazioni</p>
        <div id="detail-transactions" class="space-y-2"></div>
      </div>
      <div class="pt-4 border-t border-slate-700 text-center">
        <button onclick="App.panicButton()" class="text-red-500/40 hover:text-red-400 text-xs transition-colors">ğŸš« Tentativo di prelievo anticipato</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: PANIC -->
<div id="modal-panic" class="modal-overlay fixed inset-0 bg-black/90 backdrop-blur-sm z-[60] items-center justify-center p-6" onclick="App.closeModal('modal-panic')">
  <div class="bg-slate-900 border-2 border-red-500/40 rounded-3xl p-8 max-w-sm text-center fade-in" onclick="event.stopPropagation()">
    <div class="text-6xl mb-4">ğŸš«</div>
    <h3 class="text-2xl font-bold text-red-400 mb-2">ACCESSO NEGATO</h3>
    <p class="text-slate-300 mb-2">La matematica non ha sentimenti.</p>
    <p class="text-slate-400 text-sm mb-4 leading-relaxed">Il codice di blocco risponde con <code class="text-red-400 bg-red-500/10 px-1.5 py-0.5 rounded">REVERT</code> a ogni tentativo di prelievo anticipato.</p>
    <p class="text-white font-semibold mb-6" id="panic-date"></p>
    <button onclick="App.closeModal('modal-panic')" class="bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-xl font-medium w-full transition-colors">Torna al tuo Caveau</button>
  </div>
</div>

<!-- MODAL: SETTINGS -->
<div id="modal-settings" class="modal-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-50 items-end md:items-center justify-center p-4" onclick="App.closeModal('modal-settings')">
  <div class="bg-slate-800 rounded-3xl w-full max-w-md border border-slate-600" onclick="event.stopPropagation()">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold">Impostazioni & Sicurezza</h3>
        <button onclick="App.closeModal('modal-settings')" class="text-slate-400 hover:text-white text-2xl leading-none">Ã—</button>
      </div>
      <div class="space-y-3">
        <div class="bg-slate-900 rounded-xl p-4">
          <p class="text-slate-400 text-xs uppercase tracking-wider mb-1">Portafoglio</p>
          <p class="font-mono text-xs break-all" id="settings-address">â€”</p>
        </div>
        <button onclick="App.showSeedPhrase()" class="w-full bg-amber-500/10 border border-amber-500/30 hover:bg-amber-500/20 text-amber-400 py-3 rounded-xl text-sm font-medium transition-colors">ğŸ”‘ Mostra Seed Phrase</button>
        <a id="polygonscan-link" href="#" target="_blank" class="block w-full bg-slate-700 hover:bg-slate-600 text-center text-white py-3 rounded-xl text-sm font-medium transition-colors">ğŸ” Verifica su PolygonScan</a>
        <a href="https://github.com/creazionecontenuti-oss/caveau-digitale" target="_blank" class="block w-full bg-slate-700 hover:bg-slate-600 text-center text-white py-3 rounded-xl text-sm font-medium transition-colors">ğŸ“‚ Codice Sorgente (GitHub)</a>
        <a href="https://bafybeihulskwibpzkpc27vbuksfypc7vvw26iipmapmcyhz6pl37jp3uwm.ipfs.dweb.link/caveau-digitale/" target="_blank" class="block w-full bg-slate-700 hover:bg-slate-600 text-center text-white py-3 rounded-xl text-sm font-medium transition-colors">ğŸ™ Versione IPFS (Indistruttibile)</a>
        <button onclick="App.confirmDeleteWallet()" class="w-full bg-red-500/10 border border-red-500/30 hover:bg-red-500/20 text-red-400 py-3 rounded-xl text-sm font-medium transition-colors">ğŸ—‘ï¸ Cancella da Questo Dispositivo</button>
      </div>
      <p class="text-slate-600 text-xs mt-4 text-center">Caveau Digitale v1.0 â€¢ Non-Custodial â€¢ Open Source â€¢ IPFS</p>
    </div>
  </div>
</div>

<!-- MODAL: SHOW SEED -->
<div id="modal-show-seed" class="modal-overlay fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] items-center justify-center p-4" onclick="App.closeModal('modal-show-seed')">
  <div class="bg-slate-900 border border-amber-500/30 rounded-3xl w-full max-w-md p-6" onclick="event.stopPropagation()">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold text-amber-400">âš ï¸ Seed Phrase</h3>
      <button onclick="App.closeModal('modal-show-seed')" class="text-slate-400 hover:text-white text-2xl">Ã—</button>
    </div>
    <p class="text-slate-400 text-sm mb-4">Non mostrare questo schermo a nessuno.</p>
    <div id="show-seed-grid" class="grid grid-cols-3 gap-2 mb-5"></div>
    <button onclick="App.copySeedPhrase()" class="w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-xl text-sm font-medium transition-colors">ğŸ“‹ Copia negli appunti</button>
  </div>
</div>

<!-- MODAL: TRANSAK ON-RAMP -->
<div id="modal-transak" class="modal-overlay fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] items-end md:items-center justify-center p-0 md:p-4" onclick="App.closeModal('modal-transak')">
  <div class="bg-slate-900 rounded-t-3xl md:rounded-3xl w-full max-w-md border border-slate-600 overflow-hidden" style="height:90vh;max-height:680px" onclick="event.stopPropagation()">
    <div class="flex justify-between items-center px-5 py-4 border-b border-slate-700">
      <div>
        <h3 class="font-bold">ğŸ’³ Acquista USDC</h3>
        <p class="text-slate-400 text-xs">Bonifico o carta â†’ USDC su Polygon</p>
      </div>
      <button onclick="App.closeModal('modal-transak');document.getElementById('transak-iframe').src='';" class="text-slate-400 hover:text-white text-2xl leading-none">Ã—</button>
    </div>
    <iframe id="transak-iframe" src="" allow="camera;microphone;clipboard-read;clipboard-write;payment" class="w-full" style="height:calc(100% - 65px);border:none;"></iframe>
  </div>
</div>

<!-- MODAL: PIN VERIFY -->
<div id="modal-pin-verify" class="modal-overlay fixed inset-0 bg-black/80 backdrop-blur-sm z-[70] items-center justify-center p-6" onclick="App.closeModal('modal-pin-verify')">
  <div class="bg-slate-900 rounded-3xl w-full max-w-xs p-6 text-center" onclick="event.stopPropagation()">
    <div class="text-4xl mb-3">ğŸ”‘</div>
    <h3 class="text-lg font-bold mb-1">Conferma PIN</h3>
    <p class="text-slate-400 text-sm mb-6">Inserisci il PIN per continuare</p>
    <div class="flex justify-center gap-3 mb-4" id="pin-dots-verify">
      <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
      <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
    </div>
    <div id="pin-verify-error" class="hidden text-red-400 text-xs mb-3 bg-red-500/10 py-2 px-3 rounded-xl"></div>
    <div class="grid grid-cols-3 gap-2 max-w-[200px] mx-auto">
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('1')">1</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('2')">2</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('3')">3</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('4')">4</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('5')">5</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('6')">6</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('7')">7</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('8')">8</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('9')">9</button>
      <div></div>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyKeyPress('0')">0</button>
      <button class="pin-key bg-slate-800 rounded-2xl h-12 text-xl font-semibold" onclick="App.pinVerifyBackspace()">âŒ«</button>
    </div>
  </div>
</div>

<!-- MODAL: SABLIER LOCK -->
<div id="modal-sablier-lock" class="modal-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-[60] items-end md:items-center justify-center p-4" onclick="App.closeModal('modal-sablier-lock')">
  <div class="bg-slate-800 rounded-3xl w-full max-w-md border border-slate-600" onclick="event.stopPropagation()">
    <div class="p-6">
      <div class="flex justify-between items-center mb-5">
        <h3 class="text-xl font-bold">ğŸ”’ Blocca su Sablier</h3>
        <button onclick="App.closeModal('modal-sablier-lock')" class="text-slate-400 hover:text-white text-2xl leading-none">Ã—</button>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 mb-4 space-y-2.5">
        <div class="flex justify-between text-sm"><span class="text-slate-400">Salvadanaio</span><span class="font-medium" id="lock-vault-name"></span></div>
        <div class="flex justify-between text-sm"><span class="text-slate-400">Importo</span><span class="font-bold text-blue-400" id="lock-amount"></span></div>
        <div class="flex justify-between text-sm"><span class="text-slate-400">Sblocco il</span><span class="font-medium" id="lock-date"></span></div>
        <div class="flex justify-between text-sm"><span class="text-slate-400">Wallet</span><span class="font-mono text-xs text-slate-300" id="lock-address"></span></div>
        <div class="flex justify-between text-sm border-t border-slate-700 pt-2">
          <span class="text-slate-400">Saldo</span>
          <span id="lock-balance" class="text-slate-400 text-sm">Caricamento...</span>
        </div>
      </div>
      <div class="bg-amber-500/10 border border-amber-500/30 rounded-xl p-3 mb-4">
        <p class="text-amber-400 text-xs font-semibold mb-1">âš ï¸ Operazione Irreversibile</p>
        <p class="text-amber-300/70 text-xs">I fondi saranno matematicamente bloccati fino alla data impostata. Lo smart contract rifiuta qualsiasi prelievo anticipato.</p>
      </div>
      <div id="lock-status" class="text-sm min-h-[20px]"></div>
      <div class="space-y-2 mt-4">
        <button id="lock-execute-btn" onclick="App.executeSablierLock()" class="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 py-4 rounded-xl font-semibold transition-colors">ğŸ”’ Esegui Blocco</button>
        <button onclick="App.closeModal('modal-sablier-lock')" class="w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-xl text-sm font-medium transition-colors">Annulla</button>
      </div>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(() => {});
  }
</script>
</body>
</html>
